var BILLIARD=BILLIARD||{};(function(b){b.SimplePoint=function(a,b){this.y=this.x=0;typeof a=="undefined"&&(a=0);typeof b=="undefined"&&(b=0);this.update(a,b)};b.SimplePoint.prototype.update=function(a,c){this.x=b.Ball.correctFloatingPointError(a);this.y=b.Ball.correctFloatingPointError(c)}})(BILLIARD);
(function(b){b.CollisionResult=function(a,c,d,e){this.p1=this.p0=null;typeof a=="undefined"&&(a=0);typeof c=="undefined"&&(c=0);typeof d=="undefined"&&(d=0);typeof e=="undefined"&&(e=0);this.p0=new b.SimplePoint(a,c);this.p1=new b.SimplePoint(d,e)}})(BILLIARD);
(function(b){b.TriangleData=function(){this.dy=this.len=this.dx=this.vx=this.p1=this.vy=this.p0=0;this.p0=new b.SimplePoint;this.p1=new b.SimplePoint};b.TriangleData.prototype.refresh=function(a){typeof a=="undefined"&&(a=!1);a?(this.vx=b.Ball.correctFloatingPointError(this.p1.x-this.p0.x),this.vy=b.Ball.correctFloatingPointError(this.p1.y-this.p0.y)):this.p1.update(this.p0.x+this.vx,this.p0.y+this.vy);this.len=b.TriangleData.getHypotenuse(this.vx,this.vy);this.len>0?(this.dx=b.Ball.correctFloatingPointError(this.vx/
this.len),this.dy=b.Ball.correctFloatingPointError(this.vy/this.len)):this.dy=this.dx=0};b.TriangleData.getHypotenuse=function(a,c){return b.Ball.correctFloatingPointError(Math.sqrt(a*a+c*c))}})(BILLIARD);
(function(b){b.Ball=function(a,c){this.collision_target_time=this.proccess_time=null;this.collision=!1;this.m=1;this.dragging=!1;this.last_collision_time=this.direction=null;this.r=1;this.status=this.collision_wall_detail=this.colour=this.vy=this.vx=this.line_limit_x=this.target=null;typeof c=="undefined"&&(c=2);this.type=c;NEngine.Shape.call(this);this.cacheCanvas=document.createElement("canvas");var d=this;this.image=new Image;this.image.onload=function(){d.cacheCanvas.width=d.image.width;d.cacheCanvas.height=
d.image.height;d.cacheCanvas.getContext("2d").drawImage(d.image,0,0);d.width=d.image.width;d.height=d.image.height;d.regX=d.image.width/2;d.regY=d.image.height/2;d.r=d.image.width/2-1};this.direction=new b.TriangleData;this.direction.p0.update(this.x,this.y);this.collision=!1;this.status=0;this.dragging=!1;this.line_limit_x=538+this.r;this.updateProccessTime(1);this.image.src=a};b.Ball.w={x1:29,y1:35,x2:556,y2:326};b.Ball.isPositionOverlapped=function(){return null};b.Ball.inheritsFrom(NEngine.Shape);
b.Ball.prototype.draw=function(a,b){this.__draw(a,b)};b.Ball.simulateElasticCollision=function(a,c){var d=null,e=NaN,g=null,d=null,i=NaN,h=NaN,k=NaN,f=e=NaN,i=NaN,d=g=h=f=null,d=new b.SimplePoint(c.direction.p0.x-a.direction.p0.x,c.direction.p0.y-a.direction.p0.y),e=b.TriangleData.getHypotenuse(d.x,d.y),g=new b.SimplePoint(d.x/e,d.y/e),d=new b.SimplePoint(-g.y,g.x),i=b.Ball.correctFloatingPointError(g.x*a.direction.vx+g.y*a.direction.vy),h=b.Ball.correctFloatingPointError(d.x*a.direction.vx+d.y*a.direction.vy),
k=b.Ball.correctFloatingPointError(g.x*c.direction.vx+g.y*c.direction.vy),e=b.Ball.correctFloatingPointError(d.x*c.direction.vx+d.y*c.direction.vy),f=b.Ball.correctFloatingPointError((i*(a.m-c.m)+2*c.m*k)/(a.m+c.m)),i=b.Ball.correctFloatingPointError((k*(c.m-a.m)+2*a.m*i)/(a.m+c.m)),f=new b.SimplePoint(g.x*f,g.y*f),h=new b.SimplePoint(d.x*h,d.y*h),g=new b.SimplePoint(g.x*i,g.y*i),d=new b.SimplePoint(d.x*e,d.y*e);return new b.CollisionResult(b.Ball.correctFloatingPointError(f.x+h.x),b.Ball.correctFloatingPointError(f.y+
h.y),b.Ball.correctFloatingPointError(g.x+d.x),b.Ball.correctFloatingPointError(g.y+d.y))};b.Ball.findTimeUntilCollide=function(a,c){var d=NaN,e=NaN,g=NaN,i=NaN,e=i=NaN,d=-1,e=b.Ball.correctFloatingPointError(Math.pow(c.vx-a.vx,2)+Math.pow(c.vy-a.vy,2)),g=b.Ball.correctFloatingPointError(2*((c.direction.p0.x-a.direction.p0.x)*(c.vx-a.vx)+(c.direction.p0.y-a.direction.p0.y)*(c.vy-a.vy))),i=b.Ball.correctFloatingPointError(Math.pow(c.direction.p0.x-a.direction.p0.x,2)+Math.pow(c.direction.p0.y-a.direction.p0.y,
2)-Math.pow(a.r+c.r,2)),i=b.Ball.correctFloatingPointError(Math.pow(g,2)-4*e*i);e!=0&&(e=b.Ball.correctFloatingPointError((-g-Math.sqrt(i))/(2*e)),e>=0&&(d=e));return d};b.Ball.stillOnTable=function(a,c,d){var e=b.Ball.w;return a-d>=e.x1&&a+d<=e.x2&&c-d>=e.y1&&c+d<=e.y2};b.Ball.correctFloatingPointError=function(a,b){typeof b=="undefined"&&(b=10);var d=NaN,d=Math.pow(10,b);return Math.round(d*a)/d};b.Ball.doElasticCollision=function(a,c){var d=null,e=NaN,g=null,d=null,i=NaN,h=NaN,k=NaN,f=e=NaN,i=
NaN,d=g=h=f=null,d=new b.SimplePoint(c.direction.p0.x-a.direction.p0.x,c.direction.p0.y-a.direction.p0.y),e=b.TriangleData.getHypotenuse(d.x,d.y),g=new b.SimplePoint(d.x/e,d.y/e),d=new b.SimplePoint(-g.y,g.x),i=b.Ball.correctFloatingPointError(g.x*a.vx+g.y*a.vy),h=b.Ball.correctFloatingPointError(d.x*a.vx+d.y*a.vy),k=b.Ball.correctFloatingPointError(g.x*c.vx+g.y*c.vy),e=b.Ball.correctFloatingPointError(d.x*c.vx+d.y*c.vy),f=b.Ball.correctFloatingPointError((i*(a.m-c.m)+2*c.m*k)/(a.m+c.m)),i=b.Ball.correctFloatingPointError((k*
(c.m-a.m)+2*a.m*i)/(a.m+c.m)),f=new b.SimplePoint(g.x*f,g.y*f),h=new b.SimplePoint(d.x*h,d.y*h),g=new b.SimplePoint(g.x*i,g.y*i),d=new b.SimplePoint(d.x*e,d.y*e);a.direction.vx=b.Ball.correctFloatingPointError(f.x+h.x);a.direction.vy=b.Ball.correctFloatingPointError(f.y+h.y);a.collision=!0;c.direction.vx=b.Ball.correctFloatingPointError(g.x+d.x);c.direction.vy=b.Ball.correctFloatingPointError(g.y+d.y);c.collision=!0};b.Ball.doElasticCollisionWithWall=function(a,b){switch(b.y){case 1:a.direction.vx=
Math.abs(a.vx);a.direction.refresh();break;case 2:a.direction.vy=Math.abs(a.vy);a.direction.refresh();break;case 3:a.direction.vx=-Math.abs(a.vx);a.direction.refresh();break;case 4:a.direction.vy=-Math.abs(a.vy),a.direction.refresh()}};b.Ball.findTimeUntilCollideWithWall=function(a){var c=null,d=!1,e=NaN,c=new b.SimplePoint;c.x=-1;var d=!1,g=b.Ball.w;if(a.direction.vx<0&&(e=b.Ball.correctFloatingPointError((a.r-a.direction.p0.x+g.x1)/a.vx),e>=0))c.y=1,c.x=e,d=!0;if(a.direction.vy<0&&(e=b.Ball.correctFloatingPointError((a.r-
a.direction.p0.y+g.y1)/a.vy),e>=0&&(!d||e<c.x)))c.y=2,c.x=e,d=!0;if(a.direction.vx>0&&(e=b.Ball.correctFloatingPointError((g.x2-a.r-a.direction.p0.x)/a.vx),e>=0&&(!d||e<c.x)))c.y=3,c.x=e,d=!0;if(a.direction.vy>0&&(e=b.Ball.correctFloatingPointError((g.y2-a.r-a.direction.p0.y)/a.vy),e>=0&&(!d||e<c.x)))c.y=4,c.x=e;return c};b.Ball.prototype.allowDrag=function(){this.dragging=!1;this.onMouseDown=null;this.useHandCursor=this.mouseEnabled=!1};b.Ball.prototype.affectSpeed=function(a){typeof param1=="undefined"&&
(a=0.975);this.direction.vx=b.Ball.correctFloatingPointError(this.direction.vx*a);this.direction.vy=b.Ball.correctFloatingPointError(this.direction.vy*a);if(Math.abs(this.direction.vx)<=0.1&&Math.abs(this.direction.vy)<0.1)this.direction.vx=0,this.direction.vy=0;this.direction.refresh()};b.Ball.prototype.inHole=function(){if(this.type!=1)return!1;var a=!1,c=NaN,a=this.direction.p0.y<b.Ball.w.y2-(b.Ball.w.y2-b.Ball.w.y1)/2,c=b.Ball.w.x2-(b.Ball.w.x2-b.Ball.w.x1)/2;if(this.direction.p0.x<c+this.r/1.25&&
this.direction.p0.x>c-this.r/1.25)return this.x=c,this.y=a?b.Ball.w.y1-this.r/2:b.Ball.w.y2+this.r/2,!0;if(this.direction.p0.y<b.Ball.w.y1+this.r*1.3){if(this.direction.p0.x>b.Ball.w.x2-this.r*1.3)return this.x=b.Ball.w.x2-3,this.y=b.Ball.w.y1+3,!0;if(this.direction.p0.x<b.Ball.w.x1+this.r*1.3)return this.x=b.Ball.w.x1+3,this.y=b.Ball.w.y1+3,!0}else if(this.direction.p0.y>b.Ball.w.y2-this.r*1.3){if(this.direction.p0.x>b.Ball.w.x2-this.r*1.3)return this.x=b.Ball.w.x2-3,this.y=b.Ball.w.y2-3,!0;if(this.direction.p0.x<
b.Ball.w.x1+this.r*1.3)return this.x=b.Ball.w.x1+3,this.y=b.Ball.w.y2-3,!0}return!1};b.Ball.prototype.updateDirection=function(a,b){this.direction.p1.update(a,b);this.direction.refresh(!0)};b.Ball.prototype.move=function(a,b){this.x=a;this.y=b;this.direction.p0.update(a,b)};b.Ball.prototype.putBehindLine=function(){var a=NaN,c=NaN,d=b.Ball.w,e=this.r,a=Math.random()*(d.x2-e-this.line_limit_x),c=Math.random()*(d.y2-e-(d.y1+e));this.direction.vx=0;this.direction.vy=0;this.move(this.line_limit_x+a,d.y1+
e+c);b.Ball.isPositionOverlapped(this.x,this.y,this)!=null&&this.putBehindLine()};b.Ball.prototype.startDragging=function(){};b.Ball.prototype.updateProccessTime=function(a){this.proccess_time=b.Ball.correctFloatingPointError(a);this.vx=b.Ball.correctFloatingPointError(this.direction.vx*this.proccess_time);this.vy=b.Ball.correctFloatingPointError(this.direction.vy*this.proccess_time)}})(BILLIARD);
(function(b){b.Taco=function(a){this.holding=this.moving=!1;this.hits=0;this.last_power_factor=this.whiteBall=this.init_mouse=this.vector_mouse=this.first_hit=null;this.maxPower=120;this.RAD_TO_DEG=180/Math.PI;this.DEG_TO_RAD=Math.PI/180;this.maxRadius=100;var c=this;this.keypress=!1;NEngine.Shape.call(this);this.name="taco";this.cacheCanvas=document.createElement("canvas");this.image=new Image;this.image.onload=function(){c.cacheCanvas.width=c.image.width;c.cacheCanvas.height=c.image.height;c.cacheCanvas.getContext("2d").drawImage(c.image,
0,0);c.width=c.image.width;c.height=c.image.height;c.regX=c.image.width/2;c.regY=0};this.init_mouse=new b.TriangleData;this.vector_mouse=new b.TriangleData;this.onKeyDown=function(a){c.onPress(a)};this.onKeyUp=function(a){c.onRelease(a)};this.image.src=a};b.Taco.inheritsFrom(NEngine.Shape);b.Taco.prototype.draw=function(a,b){this.__draw(a,b)};b.Taco.prototype.init=function(a){this.moving=!0;this.holding=!1;this.hits=this.alpha=0;this.whiteBall=a};b.Taco.prototype.putOnBorder=function(a){typeof a==
"undefined"&&(a=0);var b=this.rotation+Math.PI*0.5,d=Math.sin(b),a=this.whiteBall.r+5+a;this.x=this.whiteBall.x+Math.cos(b)*a;this.y=this.whiteBall.y+d*a};b.Taco.prototype.updateState=function(){var a=null,c=NaN;if(this.moving)this.holding?(a=new b.TriangleData,a.p0=new b.SimplePoint(this.whiteBall.x,this.whiteBall.y),a.p1=new b.SimplePoint(this.parent.mouseX,this.parent.mouseY),a.refresh(!0),c=a.len-this.init_mouse.len,a.len<=this.whiteBall.r||c<=0?this.putOnBorder():c<=this.maxRadius&&(this.vector_mouse.dx>
0&&a.dx>0||this.vector_mouse.dx<0&&a.dx<0)&&this.putOnBorder(c)):(this.vector_mouse.p0=new b.SimplePoint(this.whiteBall.x,this.whiteBall.y),this.vector_mouse.p1=new b.SimplePoint(this.parent.mouseX,this.parent.mouseY),this.vector_mouse.refresh(!0),this.rotation=this.vector_mouse.dx<0?Math.PI/2+Math.atan(this.vector_mouse.vy/this.vector_mouse.vx):3*Math.PI/2+Math.atan(this.vector_mouse.vy/this.vector_mouse.vx),this.putOnBorder())};b.Taco.prototype.onPress=function(a){if(!this.keypress&&a.keyCode==
81)this.init_mouse.p0=new b.SimplePoint(this.whiteBall.x,this.whiteBall.y),this.init_mouse.p1=new b.SimplePoint(this.parent.mouseX,this.parent.mouseY),this.init_mouse.refresh(!0),this.keypress=this.holding=!0};b.Taco.prototype.onRelease=function(){var a=null,a=NaN;this.whiteBall.dragging&&this.whiteBall.allowDrag(!1);if(this.holding&&(this.keypress=this.holding=this.moving=!1,a=new b.TriangleData,a.p0=new b.SimplePoint(this.whiteBall.x+this.init_mouse.dx*this.whiteBall.r,this.whiteBall.y+this.init_mouse.dy*
this.whiteBall.r),a.p1=new b.SimplePoint(this.x,this.y),a.refresh(!0),this.putOnBorder(),a.len>0&&this.whiteBall.direction.vx==0&&this.whiteBall.direction.vy==0))this.last_power_factor=a.len/this.maxRadius,a=this.last_power_factor*this.maxPower,this.first_hit=null,this.whiteBall.updateDirection(this.whiteBall.x+a*-this.init_mouse.dx,this.whiteBall.y+a*-this.init_mouse.dy),this.hits++};b.Taco.prototype.getDirection=function(){return new b.SimplePoint(-this.vector_mouse.dx,-this.vector_mouse.dy)}})(BILLIARD);
(function(b){b.Main=function(a,c,d,e,g,i,h,k,f){this.c15=this.c14=this.c13=this.c12=this.c11=this.c10=this.c9=this.c8=this.c7=this.c6=this.c5=this.c4=this.c3=this.c2=this.c1=this.c0=this.c0_fake=null;this.balls=[];this.balls_removed=[];this.DEG_TO_RAD=Math.PI/180;this.RAD_TO_DEG=180/Math.PI;this.tri=this.diff=this.taco=this.lines=null;var j=this;this.canvas=a;this.width=585;this.height=365;this.fps=12;NEngine.env.interval=1E3/this.fps;NEngine.Stage.call(this,this.canvas);this.frenchtable=new NEngine.Bitmap(e,
0,0);this.americantable=new NEngine.Bitmap(d,0,0);this.taco=new b.Taco(f);this.white=g;this.black=i;this.red=k;this.yellow=h;b.Ball.isPositionOverlapped=function(a,c,d){typeof d=="undefined"&&(d=null);j.tri=new b.TriangleData;j.tri.p0.x=a;j.tri.p0.y=c;for(a=0;a<j.balls.length;){if(d!=j.balls[a]&&(j.tri.p1=j.balls[a].direction.p0,j.tri.refresh(!0),j.diff=b.Ball.correctFloatingPointError(j.tri.len-j.balls[a].r*2),j.diff<0))return alert("ERROR!! ball["+d.name+"] is overlapping with ["+j.balls[a].name+
"] by "+j.diff+" pixels."),j.balls[a];a++}return null};this.stagetick=this.tick;this.init(c)};b.Main.inheritsFrom(new NEngine.Stage(document.createElement("canvas")));b.Main.prototype.addBall=function(a){a.updateDirection(a.x,a.y);this.balls.push(a)};b.Main.prototype.init=function(a){this.type=a;var c=this;this.tick=this.stagetick;this.balls=[];for(this.balls_removed=[];this.numChildren>0;)this.removeChildAt(0);this.type==1?this.addChild(this.americantable):this.addChild(this.frenchtable);this.c0_fake=
new b.Ball(this.white,this.type);this.c0_fake.name="c0_fake";this.c0_fake.colour=0;this.c0_fake.alpha=0.5;this.addChild(this.c0_fake);this.c0=new b.Ball(this.white,this.type);this.c0.name="c0";this.c0.colour=0;if(this.type==1)for(a=1;a<=15;){this["c"+a]=null;if(a==8)this["c"+a]=new b.Ball(this.black,this.type),this["c"+a].colour=1;else if(a<8)this["c"+a]=new b.Ball(this.yellow,this.type),this["c"+a].colour=2;else if(a>8)this["c"+a]=new b.Ball(this.red,this.type),this["c"+a].colour=3;this["c"+a].name=
"c"+a;a++}else this.c1=new b.Ball(this.black,this.type),this.c1.name="c1",this.c1.colour=1,this.c2=new b.Ball(this.red,this.type),this.c2.name="c2",this.c2.colour=3,this.c3=new b.Ball(this.yellow,this.type),this.c3.name="c3",this.c3.colour=2;this.c0.x=471;this.c0.y=98;this.c0.direction.p0.update(this.c0.x,this.c0.y);this.addChild(this.c0);this.addBall(this.c0);if(this.type==1){this.c1.x=311;this.c1.y=248;this.c2.x=287;this.c2.y=262;this.c3.x=239;this.c3.y=289;this.c4.x=215;this.c4.y=248;this.c5.x=
239;this.c5.y=234;this.c6.x=263;this.c6.y=221;this.c7.x=215;this.c7.y=194;this.c8.x=263;this.c8.y=248;this.c9.x=287;this.c9.y=234;this.c10.x=215;this.c10.y=221;this.c11.x=239;this.c11.y=207;this.c12.x=263;this.c12.y=276;this.c13.x=239;this.c13.y=262;this.c14.x=215;this.c14.y=276;this.c15.x=215;this.c15.y=303;for(a=1;a<16;a++)this["c"+a].x-=107,this["c"+a].y-=66,this["c"+a].direction.p0.update(this["c"+a].x,this["c"+a].y),this.addChild(this["c"+a]),this.addBall(this["c"+a])}else this.c1.x=200,this.c1.y=
this.height/2,this.c1.direction.p0.update(this.c1.x,this.c1.y),this.addChild(this.c1),this.addBall(this.c1),this.c2.x=200,this.c2.y=50,this.c2.direction.p0.update(this.c2.x,this.c2.y),this.addChild(this.c2),this.addBall(this.c2),this.c3.x=200,this.c3.y=this.height-50,this.c3.direction.p0.update(this.c3.x,this.c3.y),this.addChild(this.c3),this.addBall(this.c3);this.c0.putBehindLine();this.taco.init(this.c0);this.addChild(this.taco);this.tick=function(){c.onEnterFrame()}};b.Main.prototype.onEnterFrame=
function(){for(var a=0,c=!1,d=NaN,e=NaN,g=NaN,i=NaN,h=NaN,k=!1,f=h=h=null,j=null,g=void 0,c=!1,a=0;a<this.balls.length;)this.balls[a].updateProccessTime(1),this.balls[a].direction.len>0&&(c=!0),a++;if(c){d=0;for(e=1;e>0&&c;){c=!1;for(a=0;a<this.balls.length;){this.balls[a].collision=!1;this.balls[a].target=null;this.balls[a].collision_wall_detail=null;this.balls[a].collision_target_time=Infinity;h=this.getBallsInCollision(this.balls[a]);if(h.length>0)this.balls[a].target=h[0],this.balls[a].collision_target_time=
h[0].last_collision_time;h=b.Ball.findTimeUntilCollideWithWall(this.balls[a]);if(h.x>=0&&h.x<1&&(this.balls[a].collision_target_time==Infinity||h.x<this.balls[a].collision_target_time))this.balls[a].collision_target_time=h.x,this.balls[a].collision_wall_detail=h,this.balls[a].target=null;a++}this.balls.sort(this.sortByTargetCollisionTime);h=1;k=!1;for(a=0;a<this.balls.length;){f=this.balls[a];if(f.direction.len>0&&!f.collision){j=f.target;if(j!=null&&j.target==f&&(h==1||h==f.collision_target_time)){c=
!0;if(d==0&&this.taco.first_hit==null&&(f.name=="c0"||j.name=="c0"))this.taco.first_hit=f.name=="c0"?j:f;d+=1;h=f.collision_target_time;g=f.direction.p0.x+f.vx*0.9999*h;i=f.direction.p0.y+f.vy*0.9999*h;f.move(g,i);g=j.direction.p0.x+j.vx*0.9999*h;i=j.direction.p0.y+j.vy*0.9999*h;j.move(g,i);b.Ball.doElasticCollision(f,j);f.updateProccessTime(f.proccess_time-f.proccess_time*h);f.collision=!0;f.affectSpeed(0.96);j.updateProccessTime(j.proccess_time-j.proccess_time*h);j.collision=!0;j.affectSpeed(0.96);
f.target=null;f.collision_target_time=Infinity;j.target=null;j.collision_target_time=Infinity}else if(f.collision_wall_detail!=null&&(h==1||h==f.collision_target_time))if(h=f.collision_target_time,f.move(f.direction.p0.x+f.vx*0.9999*h,f.direction.p0.y+f.vy*0.9999*h),f.inHole())for(g=0;g<this.balls.length;){if(this.balls[g]==f){f.status=1;this.balls_removed.push(f);this.balls.splice(g,1);a-=1;if(f.colour==1&&(this.balls.length==0||this.balls.length>1||this.balls.length==1&&this.balls[0].colour!=0))this.c0.status=
2;break}g+=1}else c=!0,b.Ball.doElasticCollisionWithWall(f,f.collision_wall_detail),f.collision=!0,f.updateProccessTime(f.proccess_time-f.proccess_time*h),f.affectSpeed(0.925);else c=!0,f.move(f.direction.p0.x+f.vx*h,f.direction.p0.y+f.vy*h),f.updateProccessTime(f.proccess_time-f.proccess_time*h),f.affectSpeed(0.975),f.target=null,f.collision_target_time=Infinity;k||(e=b.Ball.correctFloatingPointError(e-e*h),k=!0)}a++}}}if(this.balls_removed.length>0)for(a=0;a<this.balls_removed.length;)this.balls_removed[a].alpha<=
0?(this.balls_removed[a].visible=!1,this.balls_removed.splice(a,1),a-=1):this.balls_removed[a].alpha-=0.1,a++;else{if(!this.taco.moving&&!c&&(this.c0.status!=0||this.c0.dragging)&&this.c0.status==1)this.c0.putBehindLine(),this.c0.visible=!0,this.c0.alpha=1,this.c0.status=0,this.balls.push(this.c0);this.taco.moving=!c&&this.c0.status==0&&!this.c0.dragging;this.c0_fake.visible=!1;this.taco.moving?(this.drawLines(),this.taco.updateState(),this.taco.alpha<1?this.taco.alpha+=0.025:this.taco.alpha=1):this.taco.alpha>
0?this.taco.alpha-=0.025:this.taco.alpha=0}this.stagetick()};b.Main.prototype.getBallsInCollision=function(a){var c=null,d=0,e=NaN;a.last_collision_time=Infinity;c=[];for(d=0;d<this.balls.length;){if(this.balls[d]!=a&&(this.balls[d].last_collision_time=Infinity,e=b.Ball.findTimeUntilCollide(a,this.balls[d]),e>=0&&e<1&&(c.length==0||c[0].last_collision_time>e)))this.balls[d].last_collision_time=e,c[0]=this.balls[d];d++}return c};b.Main.prototype.drawLines=function(){var a=null,c=null,d=c=NaN,e=NaN,
g=NaN,i=null,h=0,k=NaN,c=g=null,a=new b.TriangleData;a.p0=new b.SimplePoint(this.c0.direction.p0.x,this.c0.direction.p0.y);this.c0_fake.move(this.c0.direction.p0.x,this.c0.direction.p0.y);c=this.taco.getDirection();this.c0_fake.updateDirection(this.c0_fake.direction.p0.x+c.x,this.c0_fake.direction.p0.y+c.y);this.c0_fake.updateProccessTime(1);c=this.c0_fake.direction.dx;d=this.c0_fake.direction.dy;e=this.c0_fake.direction.len;g=-1;for(h=0;h<this.balls.length;){if(this.balls[h]!=this.c0&&(k=b.Ball.findTimeUntilCollide(this.c0_fake,
this.balls[h]),k>=0&&(g==-1||k<g)))g=k,i=this.balls[h];h++}if(g==-1)g=b.Ball.findTimeUntilCollideWithWall(this.c0_fake),g=g.x;if(g>0&&(this.c0_fake.move(this.c0_fake.direction.p0.x+c*e*g,this.c0_fake.direction.p0.y+d*e*g),this.c0_fake.visible=!0,a.p1=new b.SimplePoint(this.c0_fake.direction.p0.x,this.c0_fake.direction.p0.y),a.refresh(!0),c=null,i!=null&&(c=b.Ball.simulateElasticCollision(this.c0_fake,i)),c!=null))a.p0.x=this.c0_fake.direction.p0.y,a.p0.y=this.c0_fake.direction.p0.y,a.vx=c.p0.x,a.vy=
c.p0.y,a.refresh(),a.p0.x=i.direction.p0.x,a.p0.y=i.direction.p0.y,a.vx=c.p1.x,a.vy=c.p1.y,a.refresh()};b.Main.prototype.sortByTargetCollisionTime=function(a,b){if(a.collision_target_time>b.collision_target_time)return 1;if(a.collision_target_time<b.collision_target_time)return-1;return 0};b.Main.prototype.sortByTime=function(a,b){if(a.last_collision_time>b.last_collision_time)return 1;if(a.last_collision_time<b.last_collision_time)return-1;return 0}})(BILLIARD);
